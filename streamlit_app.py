import streamlit as st
import random

# --- 페이지 설정 ---
st.set_page_config(
    page_title="단어 연상 게임",
    layout="wide"
)

# --- 게임 데이터 (단어와 정답) ---
# 중복을 제거하고, 키워드들을 소문자로 통일했습니다.
game_data = {
    "사과": ["빨강", "과일", "뉴턴", "아이폰", "달콤", "상큼", "아오리", "사과나무", "풋사과", "부사", "파이", "주스", "잼", "식초", "껍질", "아삭", "건강", "비타민", "꿀사과", "사과즙", "샐러드", "디저트", "아침", "간식", "시원", "햇빛", "농부", "농장", "빨간색", "백설공주", "애플파이", "사과잼", "사과식초", "사과주스", "사과파이", "사과즙", "사과향", "사과맛", "사과밭", "사과따기", "사과꽃", "사과씨", "사과산", "사과효소", "사과차", "사과샐러드", "사과타르트", "사과주", "사과식"],
    "바다": ["파랑", "물고기", "해변", "수영", "파도", "모래", "여름", "바닷가", "서핑", "해수욕", "조개", "소금", "낚시", "수평선", "바람", "갈매기", "여행", "휴가", "배", "잠수함", "바닷속", "심해", "산호초", "해초", "해일", "어부", "섬", "등대", "해안가", "선장", "바닷물", "바닷바람", "바닷소리", "바닷냄새", "바다여행", "바다낚시", "바다거북", "바다사자", "바다코끼리", "바다뱀", "바다게", "바다새", "바다새우", "바다물고기", "바다표범", "바다악어", "바다친구들", "바다이야기"],
    "컴퓨터": ["키보드", "마우스", "인터넷", "프로그래밍", "모니터", "CPU", "소프트웨어", "코딩", "하드웨어", "노트북", "데스크톱", "윈도우", "맥", "알파고", "인공지능", "게임", "온라인", "전원", "그래픽카드", "RAM", "파일", "폴더", "웹캠", "바이러스", "해킹", "프로그램", "운영체제", "개발자", "코더", "정보", "스크린", "커서", "아이콘", "마이크", "스피커", "프린터", "스캐너", "USB", "SSD", "HDD", "메모리", "네트워크", "와이파이", "블루투스", "데이터", "클라우드", "서버", "웹사이트", "앱", "알고리즘"],
    "고양이": ["야옹", "털", "애교", "수염", "스크래치", "생선", "귀여움", "냐옹", "집사", "캣타워", "꾹꾹이", "츄르", "냥이", "도도함", "골골송", "발바닥", "젤리", "길냥이", "야행성", "사냥", "잠", "뒹굴뒹굴", "솜방망이", "털실", "박스", "캣닙", "발톱", "고양이과", "수평", "집", "고양이밥", "고양이장난감", "고양이화장실", "고양이모래", "고양이집", "고양이카페", "고양이마을", "고양이장군", "고양이캐릭터", "고양이소리", "고양이울음소리", "고양이의자", "고양이침대", "고양이동물", "고양이친구", "고양이키우기", "고양이동물원", "고양이사랑"],
    "자동차": ["운전", "바퀴", "도로", "엔진", "핸들", "주유", "속도", "차량", "브레이크", "교통", "승용차", "트럭", "세단", "버스", "타이어", "주차", "신호등", "시동", "정비", "세차", "네비게이션", "고속도로", "운전자", "뒷좌석", "앞유리", "라이트", "연료", "브레이크등", "보닛", "머플러", "경적", "안전벨트", "백미러", "룸미러", "와이퍼", "창문", "문", "트렁크", "후진", "주유소", "주차장", "차선", "운전면허", "교통사고", "교통체증", "차종", "차값", "차번호", "차열쇠"],
    "커피": ["쓴맛", "카페", "아메리카노", "에스프레소", "원두", "향기", "졸음", "커피콩", "라떼", "카라멜", "마끼아또", "바리스타", "머그잔", "아침", "잠깨기", "디저트", "베이커리", "휴식", "직장", "오후", "따뜻", "얼음", "커피잔", "우유", "설탕", "향", "커피나무", "커피숍", "카페인", "카푸치노", "모카", "돌체라떼", "아포가토", "핸드드립", "사이폰", "로스팅", "블렌딩", "커피포트", "커피머신", "커피스푼", "커피향", "커피맛", "커피색", "커피향수", "커피프린스", "커피중독"],
    "나무": ["숲", "초록", "열매", "잎", "산소", "뿌리", "그늘", "나뭇잎", "가지", "몸통", "껍질", "숲속", "땔감", "새", "목재", "가구", "종이", "건축", "씨앗", "꽃", "봄", "가을", "겨울", "생장", "수액", "줄기", "자연", "환경", "공기", "나무가지", "나무늘보", "나무도마", "나무젓가락", "나무껍질", "나무숲", "나무그림", "나무조각", "나무향", "나무꾼", "나무열매", "나무잎", "나무줄기", "나무뿌리", "나무집", "나무위", "나무아래"],
    "강아지": ["멍멍", "산책", "털", "꼬리", "귀여움", "반려견", "장난감", "댕댕이", "간식", "주인", "목줄", "집", "훈련", "애완동물", "복슬복슬", "산책로", "코", "짖음", "사랑", "충성", "사료", "개집", "개", "개껌", "미용", "강아지풀", "입양", "동물"],
    "학교": ["교실", "선생님", "공부", "친구", "책상", "시험", "운동장", "급식", "교복", "방학", "교과서", "칠판", "복도", "졸업식", "개학", "수업", "성적", "동아리", "체육", "미술", "음악", "국어", "수학", "과학", "역사", "청소", "종례", "선생", "학생", "학교종", "학교폭력", "학교생활", "학교가는길", "학교앞", "학교종이", "학교건물"],
    "축구": ["공", "골", "선수", "경기장", "응원", "월드컵", "페널티킥", "손흥민", "메시", "호날두", "팀", "감독", "골대", "유니폼", "수비", "공격", "드리블", "패스", "슈팅", "승리", "패배", "심판", "코치", "관중", "국가대표", "프리미어리그", "챔피언스리그", "오프사이드", "코너킥", "프리킥", "헤딩", "슬라이딩", "태클", "골키퍼", "미드필더", "스트라이커", "포메이션", "축구화", "축구공", "축구장", "축구선수", "축구경기", "축구팬"],
    "책": ["독서", "도서관", "작가", "페이지", "종이", "이야기", "문장", "지식", "출판사", "소설", "시", "만화", "글", "내용", "표지", "활자", "책갈피", "서점", "책장", "도서", "이야기책", "소설책", "교과서", "백과사전", "정보", "습득", "공부", "필독", "베스트셀러", "장르", "책꽂이", "책가방", "책상", "책방"],
    "달": ["밤", "하늘", "별", "우주", "초승달", "보름달", "토끼", "계수나무", "천체", "위성", "밤하늘", "달빛", "어둠", "음력", "월식", "일식", "크레이터", "아폴로", "착륙", "탐사", "신화", "전설", "지구", "태양", "달맞이", "상현달", "하현달", "반달", "달님", "달콤", "달리기"],
    "태양": ["낮", "해", "빛", "뜨거움", "지구", "태양계", "에너지", "불", "흑점", "광합성", "열", "태양광", "일출", "일몰", "햇빛", "자외선", "태풍", "태양열", "태양풍", "태양광선", "행성", "수금지화목토천해", "우주", "에너지원", "태양광발전", "적외선", "빛의속도", "핵융합", "태양왕", "태양의후예", "태양을피하는방법"],
    "비": ["우산", "빗물", "장마", "구름", "소나기", "물웅덩이", "천둥", "번개", "소리", "촉촉함", "홍수", "개구리", "호우", "장대비", "가뭄", "비닐우산", "비옷", "빗소리", "창문", "습기", "꿉꿉함", "흐림", "물", "하늘", "시원함", "새벽비", "밤비", "가을비", "비구름", "소낙비"],
    "눈": ["겨울", "하얀색", "눈사람", "스키", "썰매", "눈송이", "함박눈", "눈싸움", "크리스마스", "영하", "눈보라", "빙하", "눈꽃", "설산", "발자국", "폭설", "눈길", "미끄러움", "눈결정", "하얀세상", "동상", "눈물", "흰색", "소복소복", "가루눈", "싸라기눈", "진눈깨비", "눈밭", "눈오는날", "동화"],
    "빵": ["밀가루", "오븐", "식빵", "케이크", "베이커리", "굽다", "잼", "버터", "크림", "반죽", "샌드위치", "토스트", "페이스트리", "바게트", "식사", "간식", "아침", "맛", "냄새", "따뜻", "바삭", "쫄깃", "빵집", "빵칼", "빵모자", "빵터지다", "빵순이", "빵돌이", "호빵", "단팥빵"],
    "지구": ["행성", "우주", "사람", "자연", "환경", "대륙", "바다", "대기", "북극", "남극", "생명", "생태계", "자전", "공전", "태양", "달", "물", "공기", "오존층", "온난화", "중력", "땅", "산", "강", "사막", "극지방", "날씨", "계절", "푸른별", "우주선"],
    "연필": ["글씨", "지우개", "연필심", "문구", "색연필", "그림", "필통", "샤프", "쓰다", "흑연", "미술", "스케치", "연필깎이", "나무", "종이", "공책", "글자", "선", "글쓰기", "공부", "시험", "연필그림", "연필로", "연필통", "연필꽂이", "연필소리", "연필선", "연필자국"],
    "전화기": ["통화", "스마트폰", "벨소리", "전화번호", "메시지", "어플", "카톡", "핸드폰", "수신", "발신", "음성통화", "영상통화", "문자", "알람", "진동", "무선", "유선", "공중전화", "전화선", "전화번호부", "친구", "가족", "연락", "소통", "통신", "휴대폰", "스마트", "폴더폰", "액정", "전화"],
    "거울": ["얼굴", "반사", "화장", "거울아", "자신", "유리", "장식", "비추다", "깨끗함", "왜곡", "마술", "왕비", "백설공주", "자화상", "실내장식", "화장실", "방", "거울방", "손거울", "전신거울", "거울샷", "거울앞", "거울보기", "거울반사", "거울닦기", "거울면", "거울에"],
    "물": ["생명", "목마름", "생수", "수분", "강", "바다", "수돗물", "얼음", "수영장", "샤워", "마시다", "맑다", "투명", "흐름", "물방울", "수증기", "물결", "빗물", "강물", "바닷물", "시냇물", "샘물", "물부족", "수분보충", "갈증", "수영", "물총", "물놀이", "물통"],
    "불": ["뜨거움", "화재", "난방", "성냥", "촛불", "재", "연기", "소방관", "요리", "캠프파이어", "화산", "불꽃", "화상", "열기", "불길", "불장난", "불끄기", "산불", "불빛", "따뜻", "밝음", "어둠", "불가마", "불닭", "불고기", "불면증", "불타는", "불이야", "불꽃놀이", "불처럼"],
    "꿈": ["잠", "상상", "무의식", "현실", "새벽", "악몽", "행복", "잠꼬대", "희망", "미래", "환상", "몽상", "잠들다", "꿈속", "꿈을꾸다", "꿈나라", "꿈해몽", "꿈같다", "꿈결", "꿈을찾아", "밤", "아침", "아름다운", "무서운", "슬픈", "즐거운", "기억", "망각", "잠못이루는"],
    "음악": ["노래", "멜로디", "악기", "콘서트", "춤", "가수", "가사", "음표", "오케스트라", "공연", "연주", "리듬", "박자", "음반", "뮤직비디오", "음악방송", "이어폰", "헤드폰", "기타", "피아노", "드럼", "바이올린", "노래방", "작곡가", "작사가", "음악가", "음악감상", "음악회", "음악선생", "음악학원"],
    "사진": ["카메라", "추억", "앨범", "찍다", "필름", "포토샵", "인화", "기념", "스튜디오", "프레임", "사진첩", "사진기", "사진작가", "사진관", "포즈", "셀카", "여행", "기록", "기억", "순간", "사진전", "사진찍기", "사진보다", "사진속", "사진을", "사진처럼", "사진사", "사진여행", "사진찍기"],
    "영화": ["배우", "극장", "스크린", "팝콘", "감독", "액션", "코미디", "드라마", "공포", "주인공", "줄거리", "예고편", "상영관", "영화관", "시나리오", "각본", "주연", "조연", "엑스트라", "영화평", "영화감상", "영화제", "영화배우", "영화감독", "영화처럼", "영화속", "영화데이트", "영화한편", "영화보기"],
    "돈": ["지갑", "현금", "저금", "부자", "은행", "재테크", "투자", "카드", "동전", "재산", "수입", "지출", "용돈", "월급", "대출", "환전", "은행권", "수표", "환전소", "경영", "경제", "부동산", "주식", "코인", "자본", "소득", "세금", "이자", "수익", "손해"],
    "시간": ["시계", "분", "초", "과거", "미래", "현재", "날짜", "달력", "흐름", "타임머신", "영원", "시간표", "시간여행", "시간낭비", "시간제한", "시간관리", "시간이", "시간은", "시간은금이다", "시간을달리는소녀", "시간이없다", "시간을내다", "시간을갖다", "시간을쓰다", "시간을벌다", "시간을보내다", "시간을재다", "시간이멈추는", "시간이흐르는"],
    "감기": ["기침", "콧물", "열", "병원", "약", "재채기", "독감", "목아픔", "두통", "환절기", "겨울", "추위", "몸살", "오한", "따뜻", "의사", "약사", "약국", "감기약", "감기조심", "감기에", "감기가", "감기에걸리다", "감기몸살", "감기기운", "감기예방", "감기바이러스"],
    "비행기": ["하늘", "공항", "여행", "조종사", "구름", "이륙", "착륙", "승무원", "기내식", "활주로", "항공권", "비행시간", "비행", "항공사", "여행지", "해외여행", "수화물", "탑승권", "비행장", "비행사", "비행기표", "비행기를타다", "비행기사고", "비행기여행", "비행기를", "비행기소리", "비행기안"],
    "계절": ["봄", "여름", "가을", "겨울", "변화", "사계절", "날씨", "온도", "봄꽃", "여름휴가", "가을단풍", "겨울눈", "계절음식", "계절별", "계절풍", "계절이", "계절의", "계절은", "계절을", "계절을타다"],
    "도시": ["건물", "교통", "사람", "서울", "번화가", "시골", "빌딩", "야경", "소음", "도시생활", "도시계획", "도시인", "도시농업", "도시락", "도시괴담", "도시가스", "도시재생", "도시환경"]
}

# --- 게임 상태 초기화 함수 ---
def init_game_state():
    """게임 상태를 초기화합니다."""
    st.session_state.game_started = True
    st.session_state.score = 0
    st.session_state.attempts = 5  # 기회 5번
    st.session_state.hint_count = 0
    st.session_state.correct_answers = 0
    st.session_state.current_word = random.choice(list(game_data.keys()))
    st.session_state.message = ""
    st.session_state.guessed_words = [] # 이미 맞힌 단어들을 추적

# --- 게임 UI ---
st.title("💡 단어 연상 게임")
st.markdown("주어진 단어를 보고, 그와 연상되는 단어를 맞춰보세요!")

# 게임 시작 버튼
if not st.session_state.get("game_started", False):
    if st.button("게임 시작"):
        init_game_state()
        st.rerun()

else:
    st.subheader(f"현재 단어: **{st.session_state.current_word}**")
    st.write(f"점수: **{st.session_state.score}**")
    st.write(f"남은 기회: **{st.session_state.attempts}**")

    # --- 사용자 입력 ---
    user_input = st.text_input("당신의 연상 단어는?", key="user_input")

    # --- 입력 처리 ---
    if st.button("제출"):
        st.session_state.message = ""  # 메시지 초기화
        user_answer_cleaned = user_input.strip().lower()

        # 정답 확인
        if user_answer_cleaned in [word.lower() for word in game_data[st.session_state.current_word]]:
            st.session_state.score += 10
            st.session_state.correct_answers += 1
            st.session_state.message = f"🎉 정답입니다! 다음 단어로 넘어갑니다."
            
            st.session_state.guessed_words.append(st.session_state.current_word)
            
            # 다음 단어 선택
            available_words = [word for word in game_data.keys() if word not in st.session_state.guessed_words]
            if not available_words:
                st.session_state.message = "🥳 모든 단어를 맞혔습니다! 게임 승리!"
                st.session_state.game_started = False
            else:
                st.session_state.current_word = random.choice(available_words)
            
            st.session_state.attempts = 5  # 정답 맞히면 기회 초기화
            st.session_state.hint_count = 0
            st.rerun()
            
        else:
            st.session_state.attempts -= 1
            if st.session_state.attempts > 0:
                st.session_state.message = f"틀렸습니다. 남은 기회: {st.session_state.attempts}"
            else:
                st.session_state.message = f"게임 오버! 정답은 '{', '.join(game_data[st.session_state.current_word])}' 입니다."
                st.session_state.game_started = False
            st.rerun()

    # 힌트 버튼
    if st.session_state.get("game_started", False):
        if st.button("힌트 보기"):
            if st.session_state.hint_count < len(game_data[st.session_state.current_word]):
                hint_word = game_data[st.session_state.current_word][st.session_state.hint_count]
                st.session_state.message = f"힌트: '{hint_word}'"
                st.session_state.hint_count += 1
            else:
                st.session_state.message = "더 이상 힌트가 없습니다."
            st.rerun()

    # --- 게임 결과 및 메시지 출력 ---
    if st.session_state.message:
        st.info(st.session_state.message)

    if not st.session_state.get("game_started", False):
        if st.button("다시 하기"):
            init_game_state()
            st.rerun()
